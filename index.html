<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MIDI Piano Player - Professional Edition</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <h1>üéπ MIDI Piano Player - Professional Edition</h1>
        <div class="subtitle">Powered by Tone.js ‚Ä¢ Acoustic Grand Piano ‚Ä¢ Professional Effects</div>
        
        <div class="tabs">
            <button class="tab active" data-tab="player">‚ñ∂ –ü–ª–µ–µ—Ä</button>
            <button class="tab" data-tab="export">üì§ –≠–∫—Å–ø–æ—Ä—Ç</button>
            <button class="tab" data-tab="import">üì• –°–æ–∑–¥–∞—Ç—å</button>
            <button class="tab" data-tab="record">üéôÔ∏è –ó–∞–ø–∏—Å—å</button>
        </div>

        <!-- TAB 1: –ü–õ–ï–ï–† -->
        <div class="tab-content active" id="player">
            <div class="upload-area" id="uploadArea">
                <div class="upload-icon">üéµ</div>
                <div class="upload-text">
                    –ù–∞–∂–º–∏—Ç–µ –∏–ª–∏ –ø–µ—Ä–µ—Ç–∞—â–∏—Ç–µ MIDI —Ñ–∞–π–ª —Å—é–¥–∞
                </div>
            </div>
            
            <input type="file" id="fileInput" accept=".mid,.midi">
            
            <div class="file-info" id="fileInfo">
                <div class="file-name" id="fileName"></div>
                <div class="info-box" id="midiInfo"></div>
                <div class="tempo-info" id="tempoInfo" style="display: none;"></div>
            </div>

            <div class="visualizer" id="visualizer">
                <canvas id="canvas"></canvas>
                <div class="viz-debug" id="vizDebug">–ù–æ—Ç: 0</div>
            </div>

            <!-- –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç—Ä–µ–∫–∞–º–∏ -->
            <div class="tracks-panel" id="tracksPanel" style="display: none;">
                <h3>üéº –¢—Ä–µ–∫–∏ –∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã</h3>
                <div class="tracks-list" id="tracksList">
                    <!-- –¢—Ä–µ–∫–∏ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </div>
            </div>

            <div class="visualization-mode" id="visualizationMode">
                <button class="viz-btn selected" data-mode="bars">üìä –°—Ç–æ–ª–±—Ü—ã</button>
                <button class="viz-btn" data-mode="wave">üåä –í–æ–ª–Ω–∞</button>
                <button class="viz-btn" data-mode="circle">‚≠ï –ö—Ä—É–≥</button>
            </div>

            <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–µ -->
            <div class="instrument-selector" id="instrumentSelector">
                <label for="instrumentType">üéπ –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç:</label>
                <select id="instrumentType">
                    <optgroup label="PIANO">
                        <option value="acoustic-grand-piano" selected>Acoustic Grand Piano</option>
                        <option value="bright-acoustic-piano">Bright Acoustic Piano</option>
                        <option value="electric-grand-piano">Electric Grand Piano</option>
                        <option value="honky-tonk-piano">Honky Tonk Piano</option>
                        <option value="electric-piano-1">Electric Piano 1</option>
                        <option value="electric-piano-2">Electric Piano 2</option>
                        <option value="harpsichord">Harpsichord</option>
                        <option value="clavinet">Clavinet</option>
                    </optgroup>
                    <optgroup label="CHROMATIC PERCUSSION">
                        <option value="celesta">Celesta</option>
                        <option value="glockenspiel">Glockenspiel</option>
                        <option value="music-box">Music Box</option>
                        <option value="vibraphone">Vibraphone</option>
                        <option value="marimba">Marimba</option>
                        <option value="xylophone">Xylophone</option>
                        <option value="tubular-bells">Tubular Bells</option>
                        <option value="dulcimer">Dulcimer</option>
                    </optgroup>
                    <optgroup label="ORGAN">
                        <option value="drawbar-organ">Drawbar Organ</option>
                        <option value="percussive-organ">Percussive Organ</option>
                        <option value="rock-organ">Rock Organ</option>
                        <option value="church-organ">Church Organ</option>
                        <option value="reed-organ">Reed Organ</option>
                        <option value="accordion">Accordion</option>
                        <option value="harmonica">Harmonica</option>
                        <option value="tango-accordion">Tango Accordion</option>
                    </optgroup>
                    <optgroup label="GUITAR">
                        <option value="nylon-string-guitar">Nylon String Guitar</option>
                        <option value="steel-string-guitar">Steel String Guitar</option>
                        <option value="jazz-guitar">Jazz Guitar</option>
                        <option value="clean-guitar">Clean Guitar</option>
                        <option value="muted-guitar">Muted Guitar</option>
                        <option value="overdriven-guitar">Overdriven Guitar</option>
                        <option value="distortion-guitar">Distortion Guitar</option>
                        <option value="guitar-harmonics">Guitar Harmonics</option>
                    </optgroup>
                    <optgroup label="BASS">
                        <option value="acoustic-bass">Acoustic Bass</option>
                        <option value="fingered-bass">Fingered Bass</option>
                        <option value="picked-bass">Picked Bass</option>
                        <option value="fretless-bass">Fretless Bass</option>
                        <option value="slap-bass-1">Slap Bass 1</option>
                        <option value="slap-bass-2">Slap Bass 2</option>
                        <option value="synth-bass-1">Synth Bass 1</option>
                        <option value="synth-bass-2">Synth Bass 2</option>
                    </optgroup>
                    <optgroup label="STRINGS">
                        <option value="violin">Violin</option>
                        <option value="viola">Viola</option>
                        <option value="cello">Cello</option>
                        <option value="contrabass">Contrabass</option>
                        <option value="tremolo-strings">Tremolo Strings</option>
                        <option value="pizzicato-strings">Pizzicato Strings</option>
                        <option value="orchestral-harp">Orchestral Harp</option>
                        <option value="timpani">Timpani</option>
                    </optgroup>
                    <optgroup label="ENSEMBLE">
                        <option value="string-ensemble-1">String Ensemble 1</option>
                        <option value="string-ensemble-2">String Ensemble 2</option>
                        <option value="synth-strings-1">Synth Strings 1</option>
                        <option value="synth-strings-2">Synth Strings 2</option>
                        <option value="choir-aahs">Choir Aahs</option>
                        <option value="voice-oohs">Voice Oohs</option>
                        <option value="synth-choir">Synth Choir</option>
                        <option value="orchestra-hit">Orchestra Hit</option>
                    </optgroup>
                    <optgroup label="BRASS">
                        <option value="trumpet">Trumpet</option>
                        <option value="trombone">Trombone</option>
                        <option value="tuba">Tuba</option>
                        <option value="muted-trumpet">Muted Trumpet</option>
                        <option value="french-horn">French Horn</option>
                        <option value="brass-section">Brass Section</option>
                        <option value="synth-brass-1">Synth Brass 1</option>
                        <option value="synth-brass-2">Synth Brass 2</option>
                    </optgroup>
                    <optgroup label="REED">
                        <option value="soprano-sax">Soprano Sax</option>
                        <option value="alto-sax">Alto Sax</option>
                        <option value="tenor-sax">Tenor Sax</option>
                        <option value="baritone-sax">Baritone Sax</option>
                        <option value="oboe">Oboe</option>
                        <option value="english-horn">English Horn</option>
                        <option value="bassoon">Bassoon</option>
                        <option value="clarinet">Clarinet</option>
                    </optgroup>
                    <optgroup label="PIPE">
                        <option value="piccolo">Piccolo</option>
                        <option value="flute">Flute</option>
                        <option value="recorder">Recorder</option>
                        <option value="pan-flute">Pan Flute</option>
                        <option value="blown-bottle">Blown Bottle</option>
                        <option value="shakuhachi">Shakuhachi</option>
                        <option value="whistle">Whistle</option>
                        <option value="ocarina">Ocarina</option>
                    </optgroup>
                    <optgroup label="SYNTH LEAD">
                        <option value="lead-square">Lead Square</option>
                        <option value="lead-sawtooth">Lead Sawtooth</option>
                        <option value="lead-calliope">Lead Calliope</option>
                        <option value="lead-chiff">Lead Chiff</option>
                        <option value="lead-charang">Lead Charang</option>
                        <option value="lead-voice">Lead Voice</option>
                        <option value="lead-fifths">Lead Fifths</option>
                        <option value="lead-bass">Lead Bass</option>
                    </optgroup>
                    <optgroup label="SYNTH PAD">
                        <option value="pad-new-age">Pad New Age</option>
                        <option value="pad-warm">Pad Warm</option>
                        <option value="pad-polysynth">Pad Polysynth</option>
                        <option value="pad-choir">Pad Choir</option>
                        <option value="pad-bowed">Pad Bowed</option>
                        <option value="pad-metallic">Pad Metallic</option>
                        <option value="pad-halo">Pad Halo</option>
                        <option value="pad-sweep">Pad Sweep</option>
                    </optgroup>
                    <optgroup label="SYNTH EFFECTS">
                        <option value="fx-rain">FX Rain</option>
                        <option value="fx-soundtrack">FX Soundtrack</option>
                        <option value="fx-crystal">FX Crystal</option>
                        <option value="fx-atmosphere">FX Atmosphere</option>
                        <option value="fx-brightness">FX Brightness</option>
                        <option value="fx-goblins">FX Goblins</option>
                        <option value="fx-echoes">FX Echoes</option>
                        <option value="fx-sci-fi">FX Sci-fi</option>
                    </optgroup>
                    <optgroup label="ETHNIC">
                        <option value="sitar">Sitar</option>
                        <option value="banjo">Banjo</option>
                        <option value="shamisen">Shamisen</option>
                        <option value="koto">Koto</option>
                        <option value="kalimba">Kalimba</option>
                        <option value="bagpipe">Bagpipe</option>
                        <option value="fiddle">Fiddle</option>
                        <option value="shanai">Shanai</option>
                    </optgroup>
                    <optgroup label="PERCUSSIVE">
                        <option value="tinkle-bell">Tinkle Bell</option>
                        <option value="agogo">Agogo</option>
                        <option value="steel-drums">Steel Drums</option>
                        <option value="woodblock">Woodblock</option>
                        <option value="taiko-drum">Taiko Drum</option>
                        <option value="melodic-tom">Melodic Tom</option>
                        <option value="synth-drum">Synth Drum</option>
                        <option value="reverse-cymbal">Reverse Cymbal</option>
                    </optgroup>
                    <optgroup label="SOUND EFFECTS">
                        <option value="guitar-fret-noise">Guitar Fret Noise</option>
                        <option value="breath-noise">Breath Noise</option>
                        <option value="seashore">Seashore</option>
                        <option value="bird-tweet">Bird Tweet</option>
                        <option value="telephone-ring">Telephone Ring</option>
                        <option value="helicopter">Helicopter</option>
                        <option value="applause">Applause</option>
                        <option value="gunshot">Gunshot</option>
                    </optgroup>
                </select>
            </div>

            <!-- –°–µ–∫—Ü–∏—è —ç—Ñ—Ñ–µ–∫—Ç–æ–≤ -->
            <div class="effects-section" id="effectsSection">
                <h3>üéõÔ∏è –ê—É–¥–∏–æ –≠—Ñ—Ñ–µ–∫—Ç—ã</h3>
                
                <div class="effect-controls">
                    <div class="effect-group">
                        <label>
                            <input type="checkbox" id="reverbEnabled" class="effect-toggle">
                            üåä –†–µ–≤–µ—Ä–±–µ—Ä–∞—Ü–∏—è
                        </label>
                        <div class="effect-params" id="reverbParams" style="display: none;">
                            <div class="slider-control-small">
                                <span>–†–∞–∑–º–µ—Ä:</span>
                                <input type="range" id="reverbDecay" min="0.1" max="10" value="2.5" step="0.1">
                                <span id="reverbDecayValue">2.5</span>
                            </div>
                            <div class="slider-control-small">
                                <span>–£—Ä–æ–≤–µ–Ω—å:</span>
                                <input type="range" id="reverbWet" min="0" max="100" value="30">
                                <span id="reverbWetValue">30%</span>
                            </div>
                        </div>
                    </div>

                    <div class="effect-group">
                        <label>
                            <input type="checkbox" id="chorusEnabled" class="effect-toggle">
                            üéµ –•–æ—Ä—É—Å
                        </label>
                        <div class="effect-params" id="chorusParams" style="display: none;">
                            <div class="slider-control-small">
                                <span>–ì–ª—É–±–∏–Ω–∞:</span>
                                <input type="range" id="chorusDepth" min="0" max="1" value="0.5" step="0.01">
                                <span id="chorusDepthValue">0.5</span>
                            </div>
                            <div class="slider-control-small">
                                <span>–ß–∞—Å—Ç–æ—Ç–∞:</span>
                                <input type="range" id="chorusFrequency" min="0.1" max="10" value="2.5" step="0.1">
                                <span id="chorusFrequencyValue">2.5 Hz</span>
                            </div>
                        </div>
                    </div>

                    <div class="effect-group">
                        <label>
                            <input type="checkbox" id="delayEnabled" class="effect-toggle">
                            ‚è±Ô∏è –î–∏–ª–µ–π
                        </label>
                        <div class="effect-params" id="delayParams" style="display: none;">
                            <div class="slider-control-small">
                                <span>–í—Ä–µ–º—è:</span>
                                <input type="range" id="delayTime" min="0.01" max="1" value="0.25" step="0.01">
                                <span id="delayTimeValue">0.25s</span>
                            </div>
                            <div class="slider-control-small">
                                <span>–ü–æ–≤—Ç–æ—Ä—ã:</span>
                                <input type="range" id="delayFeedback" min="0" max="0.9" value="0.3" step="0.01">
                                <span id="delayFeedbackValue">0.3</span>
                            </div>
                        </div>
                    </div>

                    <div class="effect-group">
                        <label>
                            <input type="checkbox" id="distortionEnabled" class="effect-toggle">
                            üî• –î–∏—Å—Ç–æ—Ä—à–Ω
                        </label>
                        <div class="effect-params" id="distortionParams" style="display: none;">
                            <div class="slider-control-small">
                                <span>–£—Ä–æ–≤–µ–Ω—å:</span>
                                <input type="range" id="distortionAmount" min="0" max="1" value="0.4" step="0.01">
                                <span id="distortionAmountValue">0.4</span>
                            </div>
                        </div>
                    </div>
                </div>
    </div>

            <div class="slider-control" id="volumeControl">
                <span class="slider-label">üîä –ì—Ä–æ–º–∫–æ—Å—Ç—å:</span>
                <input type="range" id="volumeSlider" min="0" max="100" value="70">
                <span class="slider-value" id="volumeValue">70%</span>
            </div>

            <div class="slider-control" id="tempoControl">
                <span class="slider-label">‚è±Ô∏è –¢–µ–º–ø:</span>
                <input type="range" id="tempoSlider" min="25" max="300" value="100" step="5">
                <span class="slider-value" id="tempoValue">100%</span>
            </div>
            
            <div class="progress-container" id="progressContainer">
                <div class="progress-bar" id="progressBar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div class="time-display">
                    <span id="currentTime">0:00</span>
                    <span id="totalTime">0:00</span>
                </div>
            </div>
            
            <div class="controls">
                <button id="playBtn" disabled>
                    <span>‚ñ∂</span> –ò–≥—Ä–∞—Ç—å
                </button>
                <button id="pauseBtn" disabled>
                    <span>‚è∏</span> –ü–∞—É–∑–∞
                </button>
                <button id="stopBtn" disabled>
                    <span>‚èπ</span> –°—Ç–æ–ø
                </button>
            </div>
            
            <div class="status" id="status">–ó–∞–≥—Ä—É–∑–∏—Ç–µ MIDI —Ñ–∞–π–ª –¥–ª—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –Ω–∞ —Ñ–æ—Ä—Ç–µ–ø–∏–∞–Ω–æ</div>
        </div>

        <!-- TAB 2: –≠–ö–°–ü–û–†–¢ -->
        <div class="tab-content" id="export">
            <div class="help-text">
                <h3>üì§ –≠–∫—Å–ø–æ—Ä—Ç MIDI –≤ JSON/WAV</h3>
                <p>–ó–∞–≥—Ä—É–∑–∏—Ç–µ MIDI —Ñ–∞–π–ª –≤ –ø–ª–µ–µ—Ä–µ, –∑–∞—Ç–µ–º –≤—ã–±–µ—Ä–∏—Ç–µ —Ñ–æ—Ä–º–∞—Ç —ç–∫—Å–ø–æ—Ä—Ç–∞. –ó–≤—É—á–∞–Ω–∏–µ —Ñ–æ—Ä—Ç–µ–ø–∏–∞–Ω–æ –±—É–¥–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ –≤ —Ñ–∞–π–ª–µ.</p>
            </div>

            <div class="controls">
                <button id="exportJsonBtn" disabled>
                    <span>üì•</span> –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ JSON
                </button>
                <button id="exportWavBtn" class="secondary" disabled>
                    <span>üéµ</span> –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ WAV
                </button>
            </div>

            <div class="json-editor">
                <label>JSON –¥–∞–Ω–Ω—ã–µ:</label>
                <textarea id="jsonOutput" placeholder="JSON –¥–∞–Ω–Ω—ã–µ –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å –ø–æ—Å–ª–µ —ç–∫—Å–ø–æ—Ä—Ç–∞..." readonly></textarea>
            </div>

            <div class="controls">
                <button id="downloadJsonBtn" class="secondary" disabled>
                    <span>üíæ</span> –°–∫–∞—á–∞—Ç—å JSON
                </button>
            </div>
        </div>

        <!-- TAB 3: –°–û–ó–î–ê–¢–¨ MIDI -->
        <div class="tab-content" id="import">
            <div class="help-text">
                <h3>üì• –°–æ–∑–¥–∞–Ω–∏–µ MIDI –¥–ª—è —Ñ–æ—Ä—Ç–µ–ø–∏–∞–Ω–æ –∏–∑ JSON</h3>
                <p>–§–æ—Ä–º–∞—Ç JSON:</p>
                <code>{"tracks": [{"notes": [{"note": 60, "time": 0, "duration": 0.5, "velocity": 100}]}]}</code>
                <p style="margin-top: 10px;"><strong>note:</strong> MIDI –Ω–æ—Ç–∞ (60 = C4), <strong>time:</strong> –≤—Ä–µ–º—è –≤ —Å–µ–∫—É–Ω–¥–∞—Ö, <strong>duration:</strong> –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, <strong>velocity:</strong> –≥—Ä–æ–º–∫–æ—Å—Ç—å (0-127)</p>
            </div>

            <div class="upload-area-small" id="jsonUploadArea">
                <div class="upload-icon">üìÑ</div>
                <div class="upload-text">
                    –ù–∞–∂–º–∏—Ç–µ –∏–ª–∏ –ø–µ—Ä–µ—Ç–∞—â–∏—Ç–µ JSON —Ñ–∞–π–ª —Å—é–¥–∞
                </div>
            </div>
            
            <input type="file" id="jsonFileInput" accept=".json">

            <div class="json-editor">
                <label>–ò–ª–∏ –≤–≤–µ–¥–∏—Ç–µ JSON –≤—Ä—É—á–Ω—É—é:</label>
                <textarea id="jsonInput" placeholder='{"tracks": [{"notes": [{"note": 60, "time": 0, "duration": 0.5, "velocity": 100}]}]}'></textarea>
            </div>

            <div class="controls">
                <button id="createMidiBtn">
                    <span>üéµ</span> –°–æ–∑–¥–∞—Ç—å MIDI —Ñ–∞–π–ª
                </button>
                <button id="previewMidiBtn" class="secondary">
                    <span>‚ñ∂</span> –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä
                </button>
            </div>

            <div class="status" id="importStatus"></div>
        </div>

        <!-- TAB 4: –ó–ê–ü–ò–°–¨ -->
        <div class="tab-content" id="record">
            <div class="help-text">
                <h3>üéôÔ∏è –ó–∞–ø–∏—Å—å –∑–≤—É—á–∞–Ω–∏—è —Ñ–æ—Ä—Ç–µ–ø–∏–∞–Ω–æ –≤ –∞—É–¥–∏–æ —Ñ–∞–π–ª</h3>
                <p>–ó–∞–≥—Ä—É–∑–∏—Ç–µ MIDI —Ñ–∞–π–ª –≤ –ø–ª–µ–µ—Ä–µ, –∑–∞—Ç–µ–º –Ω–∞–∂–º–∏—Ç–µ "–ù–∞—á–∞—Ç—å –∑–∞–ø–∏—Å—å" –∏ "–ò–≥—Ä–∞—Ç—å". –ü–æ—Å–ª–µ –æ–∫–æ–Ω—á–∞–Ω–∏—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –Ω–∞–∂–º–∏—Ç–µ "–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–ø–∏—Å—å" –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∞—É–¥–∏–æ.</p>
            </div>

            <div class="recording-indicator" id="recordingIndicator">
                ‚ö´ –ò–¥–µ—Ç –∑–∞–ø–∏—Å—å...
            </div>

            <div class="controls">
                <button id="startRecordBtn" disabled>
                    <span>‚ö´</span> –ù–∞—á–∞—Ç—å –∑–∞–ø–∏—Å—å
                </button>
                <button id="stopRecordBtn" disabled>
                    <span>‚èπ</span> –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–ø–∏—Å—å
                </button>
            </div>

            <div class="controls">
                <button id="downloadAudioBtn" class="secondary" disabled>
                    <span>üíæ</span> –°–∫–∞—á–∞—Ç—å –∞—É–¥–∏–æ (WAV)
                </button>
            </div>

            <div class="status" id="recordStatus">–ó–∞–≥—Ä—É–∑–∏—Ç–µ MIDI —Ñ–∞–π–ª –¥–ª—è –Ω–∞—á–∞–ª–∞ –∑–∞–ø–∏—Å–∏ —Ñ–æ—Ä—Ç–µ–ø–∏–∞–Ω–æ</div>
        </div>
    </div>

    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º Tone.js –∏–∑ CDN -->
    <script src="https://cdn.jsdelivr.net/npm/tone@14.8.49/build/Tone.js"></script>
    
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º –º–æ–¥—É–ª–∏ –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ -->
    <script src="sampler-instruments.js"></script>
    <script src="config.js"></script>
    <script src="instrument-manager.js"></script>
    <script src="midi-parser.js"></script>
    <script src="midi-writer.js"></script>
    <script src="visualizer.js"></script>
    <script src="audio-effects.js"></script>
    <script src="midi-player.js"></script>
    <script src="ui-controller.js"></script>
    <script src="main.js"></script>
</body>
</html>
